<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Weld: Weld meets Vert.x
    </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Weld meets Vert.x" name="description">
    <link href="/images/weld_icon_32x.ico" rel="shortcut icon" type="image/x-icon">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//static.jboss.org/css/tabzilla.css" media="screen" rel="stylesheet" type="text/css">
    <link href="https://weld.cdi-spec.org/stylesheets/styles.css" rel="stylesheet" type="text/css">
    <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="//static.jboss.org/js/_jbossorg-tabzilla.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <link href="https://weld.cdi-spec.org/news.atom" rel="alternate" type="application/atom+xml">
    <link href="//cdn.jsdelivr.net/highlight.js/8.9.1/styles/hybrid.min.css" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/highlight.js/8.9.1/highlight.min.js" type="text/javascript"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-2 col-sm-3">
          <div class="sidebar-nav">
            <div class="navbar navbar-default" role="navigation">
              <div class="navbar-header">
                <button ="button" class="navbar-toggle" data-target=".sidebar-navbar-collapse" data-toggle="collapse">
                  <span class="sr-only">
                    Toggle navigation
                  </span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a ="#" class="visible-xs navbar-brand">
                  <img alt="Weld Logo" src="/images/weld_logo_100x.png">
                </a>
              </div>
              <div class="collapse navbar-collapse sidebar-navbar-collapse">
                <ul class="nav navbar-nav">
                  <li>
                    <a href="/">
                      <i class="fa fa-home"></i>
                      &nbsp;Home
                    </a>
                  </li>
                  <li>
                    <a href="/download">
                      <i class="fa fa-download"></i>
                      &nbsp;Download
                    </a>
                  </li>
                  <li>
                    <a href="/news">
                      <i class="fa fa-newspaper-o"></i>
                      &nbsp;News
                    </a>
                  </li>
                  <li>
                    <a href="https://issues.jboss.org/projects/WELD?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page" target="_blank">
                      <i class="fa fa-road"></i>
                      &nbsp;Road Map
                    </a>
                  </li>
                  <li>
                    <a href="/documentation">
                      <i class="fa fa-book"></i>
                      &nbsp;Docs &amp; FAQ
                    </a>
                  </li>
                  <li>
                    <a href="/news/tags/tips">
                      <i class="fa fa-lightbulb-o"></i>
                      &nbsp;Tips and Tricks
                    </a>
                  </li>
                  <li>
                    <a href="/community">
                      <i class="fa fa-group"></i>
                      &nbsp;Community
                    </a>
                  </li>
                  <li>
                    <a href="http://github.com/weld" target="_blank">
                      <i class="fa fa-github-alt"></i>
                      &nbsp;Source Code
                    </a>
                  </li>
                  <li>
                    <a href="https://issues.jboss.org/browse/WELD#selectedTab=com.atlassian.jira.plugin.system.project%3Asummary-panel" target="_blank">
                      <i class="fa fa-tasks"></i>
                      &nbsp;Bug Tracker
                    </a>
                  </li>
                  <li>
                    <a href="https://twitter.com/jbossweld" target="_blank">
                      <i class="fa fa-twitter"></i>
                      &nbsp;Follow @jbossweld
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-10 col-sm-9">
          <div class="row hidden-xs">
            <div class="dropup">
              <div id="ajbossproject">
                A JBoss Project
              </div>
              <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
              <script>
                window.addEventListener('load', function() {renderTabzilla("Weld", "weld", false )}, false);
              </script>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <a href="/">
                <img alt="Weld Logo" class="hidden-xs weld-home-logo" src="/images/weld_logo_450x.png">
              </a>
            </div>
            <div class="col-md-8">
              <img alt="CDI tagcloud" class="hidden-xs hidden-sm cdi-background" src="/images/CDIbackground.png">
            </div>
          </div>
          <div class="row content-wrapper">
            <div class="col-md-12">
              <div class="post">
                <h1>
                  Weld meets Vert.x
                  <a href="http://weld.cdi-spec.org/news.atom" title="Subscribe to Weld news">
                    <i class="fa fa-rss"></i>
                  </a>
                </h1>
                <div class="news-date news-boxed">
                  2016-4-11
                  &nbsp;
                  <span class="tags">
                    <i class="fa fa-tags"></i>
                    <a href="/news/tags/vertx">vertx</a>
                    ,
                    <a href="/news/tags/integration">integration</a>
                  </span>
                  &nbsp;
                  <i class="fa fa-pencil"></i>
                  Martin Kouba
                </div>
                <p></p>
                <div class="content">
                  <div class="paragraph">
                  <p><a href="http://vertx.io/" target="_blank" rel="noopener">Vert.x</a> defines itself as "a toolkit for building reactive applications on the JVM".
                  Sounds cool and trendy.
                  Weld, on the other hand, comes from the Java EE world, based on standards and traditional concepts.
                  But wait, what if we try to combine the two worlds to get the best of them?</p>
                  </div>
                  <div class="paragraph">
                  <p>Vert.x makes use of a light-weight distributed messaging system to allow application components to communicate in a loosely coupled way.
                  This should sound familiar to all CDI users where beans may produce and consume events as well.
                  Weld team developed a <a href="https://github.com/weld/weld-vertx">working prototype</a> of Weld/Vert.x integration that allows to automatically register certain observer methods as Vert.x message consumers.
                  A simple echo message consumer could look like this:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.jboss.weld.vertx.VertxConsumer;&#x000A;import org.jboss.weld.vertx.VertxEvent;&#x000A;&#x000A;class Foo {&#x000A;    public void echoConsumer(@Observes @VertxConsumer("test.echo.address") VertxEvent event) {&#x000A;        event.setReply(event.getMessageBody());&#x000A;    }&#x000A;}</code></pre>
                  </div>
                  </div>
                  <div class="ulist">
                  <ul>
                  <li>
                  <p><code>@VertxConsumer</code> - a qualifier used to specify the address the consumer will be registered to: <code>test.echo.address</code></p>
                  </li>
                  <li>
                  <p><code>VertxEvent</code> - a wrapper of a Vert.x message</p>
                  </li>
                  </ul>
                  </div>
                  <div class="paragraph">
                  <p>Since we&#8217;re working with a regular observer method, additional parameters may be declared (next to the event parameter).
                  These parameters are injection points. So it&#8217;s easy to <strong>declare a message consumer dependencies</strong>:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void consumerWithDependencies(@Observes @VertxConsumer("test.dependencies.address") VertxEvent event, CoolService coolService, StatsService statsService) {&#x000A;    coolService.process(event.getMessageBody());&#x000A;    statsService.log(event);&#x000A;}</code></pre>
                  </div>
                  </div>
                  <div class="admonitionblock note">
                  <table>
                  <tr>
                  <td class="icon">
                  <div class="title">Note</div>
                  </td>
                  <td class="content">
                  If you inject a dependent bean, it will be destroyed when the invocation completes.
                  </td>
                  </tr>
                  </table>
                  </div>
                  <div class="paragraph">
                  <p>Last but not least - an observer may also <strong>send/publish messages using the Vert.x event bus</strong>:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void consumerStrikesBack(@Observes @VertxConsumer("test.publish.address") VertxEvent event) {&#x000A;    event.messageTo("test.huhu.address").publish("huhu");&#x000A;}</code></pre>
                  </div>
                  </div>
                  <div class="paragraph">
                  <p>And how does it work under the hood?
                  First of all, it&#8217;s necessary to deploy <code>org.jboss.weld.vertx.WeldVerticle</code>.
                  This <code>Verticle</code> starts Weld SE container and automatically registers <code>org.jboss.weld.vertx.VertxExtension</code> to process all observer methods and detect observers which should become message consumers.
                  Then a special handler is registered for each address to bridge the event bus to the CDI world.
                  Handlers use <code>Vertx.executeBlocking()</code> since we expect the code to be blocking.
                  Later on, whenever a new message is delivered to the handler, <code>Event.fire()</code> is used to notify all relevant observers.</p>
                  </div>
                  <div class="paragraph">
                  <p>The prototype is surely missing some features. Nevertheless, it shows the CDI programming model might be applicable to the "reactive" world even if not a first class citizen.
                  Moreover, the prototype demonstrates the flexibility of the CDI extension mechanism.</p>
                  </div>
                  <div class="paragraph">
                  <p>If you want to try it out, you&#8217;ll have to clone the <a href="https://github.com/weld/weld-vertx" class="bare">https://github.com/weld/weld-vertx</a> repository and build it from source (i.e. run <code>mvn clean install</code>).
                  And if you find it useful feel free to add comments to this blog post. Any feedback is appreciated!</p>
                  </div>
                </div>
                
                            <div id="disqus_thread"></div>
                            <script type="text/javascript">
                            var disqus_shortname = 'weld-cdi';
                            var disqus_url = "https://weld.cdi-spec.org/news/2016/04/11/weld-meets-vertx/";
                            var disqus_developer = null;
                            var disqus_identifier = "af501f042c2934f75528c9cf997f3afe9605b4aa";
                            (function() {
                              var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                              (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                            })();
                            </script>
                            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=weld-cdi">comments powered by Disqus.</a></noscript>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        <div class="container" id="companyfooter">
          <div class="redhatlogo" style="text-align:center;">
            <div class="logospacer" style="height:10px;"></div>
            <a href="http://www.redhat.com/">
              <img src="http://static.jboss.org/theme/images/common/redhat_logo.png">
            </a>
          </div>
        </div>
      </div>
    </footer>
  </body>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount','UA-45187401-1']);
  _gaq.push(['_trackPageview']);
  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>
  <script>
    $(document).ready(function() {
      $('#toggle_menu').click(function(){
        $("#mobile_menu").toggle();
      });
    });
  </script>
</html>
