<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>
Weld: News - tagged as &quot;cdi2&quot;
</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Latest news about Weld." name="description">
<link href="/images/weld_icon_32x.ico" rel="shortcut icon" type="image/x-icon">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="//static.jboss.org/css/tabzilla.css" media="screen" rel="stylesheet" type="text/css">
<link href="https://weld.cdi-spec.org/stylesheets/styles.css" rel="stylesheet" type="text/css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="//static.jboss.org/js/_jbossorg-tabzilla.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]-->
<link href="https://weld.cdi-spec.org/news.atom" rel="alternate" type="application/atom+xml">
<link href="//cdn.jsdelivr.net/highlight.js/8.9.1/styles/hybrid.min.css" rel="stylesheet">
<script src="//cdn.jsdelivr.net/highlight.js/8.9.1/highlight.min.js" type="text/javascript"></script>
<script>
hljs.initHighlightingOnLoad();
</script>
</head>
<body>
<div class="container-fluid">
<div class="row">
<div class="col-md-2 col-sm-3">
<div class="sidebar-nav">
<div class="navbar navbar-default" role="navigation">
<div class="navbar-header">
<button ="button" class="navbar-toggle" data-target=".sidebar-navbar-collapse" data-toggle="collapse">
<span class="sr-only">
Toggle navigation
</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a ="#" class="visible-xs navbar-brand">
<img alt="Weld Logo" src="/images/weld_logo_100x.png">
</a>
</div>
<div class="collapse navbar-collapse sidebar-navbar-collapse">
<ul class="nav navbar-nav">
<li>
<a href="/">
<i class="fa fa-home"></i>
&nbsp;Home
</a>
</li>
<li>
<a href="/download">
<i class="fa fa-download"></i>
&nbsp;Download
</a>
</li>
<li>
<a href="/news">
<i class="fa fa-newspaper-o"></i>
&nbsp;News
</a>
</li>
<li>
<a href="https://issues.jboss.org/projects/WELD?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page" target="_blank">
<i class="fa fa-road"></i>
&nbsp;Road Map
</a>
</li>
<li>
<a href="/documentation">
<i class="fa fa-book"></i>
&nbsp;Docs &amp; FAQ
</a>
</li>
<li>
<a href="/news/tags/tips">
<i class="fa fa-lightbulb-o"></i>
&nbsp;Tips and Tricks
</a>
</li>
<li>
<a href="/community">
<i class="fa fa-group"></i>
&nbsp;Community
</a>
</li>
<li>
<a href="http://github.com/weld" target="_blank">
<i class="fa fa-github-alt"></i>
&nbsp;Source Code
</a>
</li>
<li>
<a href="https://issues.jboss.org/browse/WELD#selectedTab=com.atlassian.jira.plugin.system.project%3Asummary-panel" target="_blank">
<i class="fa fa-tasks"></i>
&nbsp;Bug Tracker
</a>
</li>
<li>
<a href="https://twitter.com/jbossweld" target="_blank">
<i class="fa fa-twitter"></i>
&nbsp;Follow @jbossweld
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="col-md-10 col-sm-9">
<div class="row hidden-xs">
<div class="dropup">
<div id="ajbossproject">
A JBoss Project
</div>
<a class="tabnav-closed" href="#" id="tab">Red Hat</a>
<script>
window.addEventListener('load', function() {renderTabzilla("Weld", "weld", false )}, false);
</script>
</div>
</div>
<div class="row">
<div class="col-md-4">
<a href="/">
<img alt="Weld Logo" class="hidden-xs weld-home-logo" src="/images/weld_logo_450x.png">
</a>
</div>
<div class="col-md-8">
<img alt="CDI tagcloud" class="hidden-xs hidden-sm cdi-background" src="/images/CDIbackground.png">
</div>
</div>
<div class="row content-wrapper">
<div class="col-md-12">
<h1>
News - tagged as &quot;cdi2&quot;
<a href="http://weld.cdi-spec.org/news.atom">
<i class="fa fa-rss"></i>
</a>
</h1>
<div class="post">
<h2>
<a href="/news/2016/04/28/weld-300Alpha16/">Weld 3.0.0.Alpha16</a>
</h2>
<div class="news-date news-boxed">
2016-4-28
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Martin Kouba
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>The next experimental Weld version has been released!
See also <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327858" target="_blank" rel="noopener">the release details</a>.
Thanks to everyone involved in this release!</p>
</div>
<div class="paragraph">
<p>This release includes a lot of bugfixes and improvements (e.g. all the notable tasks implemented in the latest stable version: <a href="/news/2016/04/22/weld-234Final/">Weld 2.3.4.Final</a>).
However, the main goal of this release is to align with CDI API 2.0.Alpha4, and in particular to implement the current version of "metadata builders" API (<a href="https://issues.jboss.org/browse/CDI-558" target="_blank" rel="noopener">CDI-558</a>).
So that everyone can play with the API, discover possibilities and find potential issues.
Note that this release also introduces a non-standard experimental feature: <a href="/news/2016/02/08/weld-se-synth-lifecycle-events/">Weld SE synthetic container lifecycle event observers</a>.
So it should be even easier to get started - no extension class is needed in Weld SE.</p>
</div>
<div class="sect1">
<h2 id="_metadata_configurators_basic_ideas">Metadata configurators - basic ideas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that we don&#8217;t use the term "builder" because there is no <code>build()</code> method in the API.
Also note that the API is not intended to cover every possible case.
Instead, we would like to help with common tasks.
And if necessary, an extension developer can always use the original replacement methods for more complicated stuff.</p>
</div>
<div class="paragraph">
<p>IMPORTANT POINTS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an extension developer receives a configurator instance from a container lifecycle event</p>
</li>
<li>
<p>a configurator instance is always automatically processed at the end of the observer invocation</p>
</li>
<li>
<p>for <strong>bean discovery events</strong> (all events starting with <code>Process</code>):</p>
<div class="ulist">
<ul>
<li>
<p><code>configureX()</code> methods return the same configurator instance (for the given observer method invocation)</p>
</li>
<li>
<p>the configurator is initialized/preconfigured with the component being processed, e.g. <code>ProcessAnnotatedType.configureAnnotatedType()</code> returns a configurator initialized with <code>ProcessAnnotatedType.getAnnotatedType()</code></p>
</li>
<li>
<p>the result of the configurator will automatically replace the original component (e.g. <code>AnnotatedType</code> in case of <code>ProcessAnnotatedType</code>)</p>
</li>
<li>
<p>replacement methods (e.g. <code>ProcessAnnotatedType.setAnnotatedType()</code>) should not be used together with configurators (<a href="https://issues.jboss.org/browse/CDI-596" target="_blank" rel="noopener">CDI-596</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>for <strong>application lifecycle events</strong> (e.g. <code>AfterBeanDiscovery</code>):</p>
<div class="ulist">
<ul>
<li>
<p><code>addX()</code> methods always return a new configurator instance</p>
</li>
<li>
<p>the configurator is always uninitialized/empty, but we should probably define some default values wherever it makes sense (e.g. <code>Reception</code> for observer methods)</p>
</li>
<li>
<p>the result of the configurator will be automatically added (e.g. <code>Bean</code> in case of <code>AfterBeanDiscovery.addBean()</code>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have prepared some simple examples - see below.
More advanced examples can be found in <a href="https://github.com/cdi-spec/cdi-tck/tree/master/impl/src/main/java/org/jboss/cdi/tck/tests/extensions/configurators" target="_blank" rel="noopener">the TCK test cases</a>.
And as usual - feel free to add comments to this blog post. Any feedback is appreciated!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beforebeandiscovery_example">BeforeBeanDiscovery example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Singleton&#x000A;class MyService {&#x000A;    // This class is not placed in a bean archive&#x000A;}&#x000A;&#x000A;class MyExtension implements Extension {&#x000A;&#x000A;    void beforeBeanDiscovery(@Observes BeforeBeanDiscovery event) {&#x000A;        // Add MyService to the set of discovered classes and replace @Singleton with @ApplicationScoped&#x000A;        event.addAnnotatedType(MyService.class.getName(), MyService.class)&#x000A;               .remove(Singleton.class)&#x000A;               .add(ApplicationScoped.Literal.INSTANCE);&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_processannotatedtype_example">ProcessAnnotatedType example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyExtension implements Extension {&#x000A;&#x000A;    void processAnnotatedType(@Observes @WithAnnotations({ Observes.class, ObservesAsync.class }) ProcessAnnotatedType&lt;?&gt; event) {&#x000A;        // Add interceptor binding to all methods annotated with @Observes or @ObservesAsync&#x000A;        event.configureAnnotatedType()&#x000A;                .filterMethods(MyExtension::isObserver)&#x000A;                .forEach(methodConfigurator -&gt; methodConfigurator.add(Monitored.Literal.INSTANCE))&#x000A;    }&#x000A;&#x000A;    static boolean isObserver(AnnotatedMethod&lt;?&gt; annotatedMethod) {&#x000A;        return annotatedMethod.isAnnotationPresent(Observes.class) || annotatedMethod.isAnnotationPresent(ObservesAsync.class);&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_processbeanattributes_example">ProcessBeanAttributes example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyExtension implements Extension {&#x000A;&#x000A;    void processBeanAttributes(@Observes ProcessBeanAttributes&lt;?&gt; event) {&#x000A;        // For all beans remove the IllegalBeanType from the set of bean types&#x000A;        if (event.getBeanAttributes().getTypes().contains(IllegalBeanType.class)) {&#x000A;            Set&lt;Type&gt; legalTypes = new HashSet(event.getBeanAttributes().getTypes());&#x000A;            legalTypes.remove(IllegalBeanType.class);&#x000A;            event.configureBeanAttributes().types(legalTypes);&#x000A;        }&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_afterbeandiscovery_example">AfterBeanDiscovery example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyExtension implements Extension {&#x000A;&#x000A;    void afterBeanDiscovery(@Observes AfterBeanDiscovery event) {&#x000A;        //  Add a new synthetic observer method - no need to use the fluent API&#x000A;        ObserverMethodConfigurator&lt;Foo&gt; configurator = event.&lt;Foo&gt;addObserverMethod();&#x000A;        configurator.observedType(Foo.class);&#x000A;        configurator.reception(Reception.ALWAYS);&#x000A;        configurator.transactionPhase(TransactionPhase.IN_PROGRESS);&#x000A;        configurator.notifyWith((foo) -&gt; System.out.println("Foo observed: " + foo));&#x000A;&#x000A;        // Add dependent bean - Integer between 0 and 999&#x000A;        event.addBean().addType(Integer.class).addQualifier(Random.Literal.INSTANCE)&#x000A;                .produceWith(() -&gt; new java.util.Random().nextInt(1000))&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wildfly_patch">WildFly Patch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As usual, a <a href="http://download.jboss.org/weld/3.0.0.Alpha16/wildfly-10.0.0.Final-weld-3.0.0.Alpha16-patch.zip" target="_blank" rel="noopener">patch for WildFly</a> is available. This time the target platform is <strong>WildFly 10.0.0.Final</strong>.  If you’re not familiar with patching WildFly, check <a href="http://blog.eisele.net/2015/02/playing-with-weld-probe-see-all-of-your.html" target="_blank" rel="noopener">Markus&#8217;s tutorial</a>.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="/download/">Download</a> &#93;
&#91; <a href="http://docs.jboss.org/weld/reference/3.0.0.Alpha16/en-US/html/" target="_blank" rel="noopener">Documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327858" target="_blank" rel="noopener">Release notes</a> &#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2016/02/04/weld-300Alpha15/">Weld 3.0.0.Alpha15</a>
</h2>
<div class="news-date news-boxed">
2016-2-4
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Martin Kouba
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Weld 3.0.0.Alpha15 the next experimental Weld version has been released.
See also <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327857">the release details</a>.</p>
</div>
<div class="paragraph">
<p>The <code>CompletionStage</code> used to bind actions to the completion of the asynchronous delivery is now using <code>org.jboss.weld.manager.api.ExecutorServices</code> SPI as the default asynchronous execution facility.
Previously, the <code>ForkJoinPool#commonPool()</code> (a default executor of the underlying <code>CompletableFuture</code>) was used.
It&#8217;s an important change because the <code>ForkJoinPool#commonPool()</code> is not a good fit for Java EE.
See also <a href="https://issues.jboss.org/browse/WELD-2073">WELD-2073</a>.</p>
</div>
<div class="paragraph">
<p>The <code>ExperimentalAfterBeanDiscovery</code> receives two more methods: <code>interceptorBuilder()</code> and <code>addInterceptor()</code>.
An interceptor builder allows you to create an interceptor bean without the need to create an interceptor class.
This might be handy for simple use cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class MyExtension {&#x000A;  void afterBeanDiscovery(@Observes AfterBeanDiscovery event) {&#x000A;    event.addInterceptor().intercept(InterceptionType.AROUND_INVOKE, (c) -&gt; {&#x000A;            long start = System.currentTimeMillis();&#x000A;            try {&#x000A;                return c.proceed();&#x000A;            } finally {&#x000A;                System.out.println("Time: " + System.currentTimeMillis() - start);&#x000A;            }&#x000A;        }).priority(2600).addBinding(MonitoringBinding.Literal.INSTANCE);&#x000A;  }&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="https://issues.jboss.org/browse/WELD-2008">WELD-2008</a>.</p>
</div>
<div class="paragraph">
<p>This release also contains some enhancements and bugfixes around proxies.
E.g. better support for DeltaSpike partial beans (<a href="https://issues.jboss.org/browse/WELD-2084">WELD-2084</a>), better support for Camel CDI (<a href="https://issues.jboss.org/browse/WELD-2089">WELD-2089</a>) and better support for proxies with non public classes (<a href="https://issues.jboss.org/browse/WELD-2091">WELD-2091</a>).
Furthermore, we are going to drop Jetty 7,8, 9.0, 9.1 and 9.2 support in Weld 3 (<a href="https://issues.jboss.org/browse/WELD-2032">WELD-2032</a>).
Also the decorator validation was improved (<a href="https://issues.jboss.org/browse/WELD-2085">WELD-2085</a>, <a href="https://issues.jboss.org/browse/WELD-1811">WELD-1811</a>, <a href="https://issues.jboss.org/browse/WELD-2039">WELD-2039</a>).
Last but not least, we have performed some SPI cleanup (<a href="https://issues.jboss.org/browse/WELD-2077">WELD-2077</a>, <a href="https://issues.jboss.org/browse/WELD-2079">WELD-2079</a>).</p>
</div>
<div class="sect1">
<h2 id="_wildfly_patch">WildFly Patch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As usual, a <a href="http://download.jboss.org/weld/3.0.0.Alpha15/wildfly-10.0.0.Final-weld-3.0.0.Alpha15-patch.zip">patch for WildFly</a> is available. This patch not only upgrades Weld within an existing WildFly instance but also upgrades CDI API to 2.0 EDR1. This time the target platform is <strong>WildFly 10.0.0.Final</strong>.  If you’re not familiar with patching WildFly, check <a href="http://blog.eisele.net/2015/02/playing-with-weld-probe-see-all-of-your.html">Markus&#8217;s tutorial</a>.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327857">Release notes</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha15/weld-3.0.0.Alpha15.zip">Distribution</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha15/wildfly-10.0.0.Final-weld-3.0.0.Alpha15-patch.zip">Patch for Wildfly 10.0.0.Final</a>
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2015/12/04/weld-300Alpha14/">Weld 3.0.0.Alpha14</a>
</h2>
<div class="news-date news-boxed">
2015-12-4
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Martin Kouba
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Weld 3.0.0.Alpha14 the penultimate Weld version for this year has been released into the wild.
It reflects some of the most recent changes in the CDI 2.0 specification, mostly related to asynchronous events.
Moreover, this release also contains quite a lot of enhancements and bugfixes. See also <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327856">the release details</a>.</p>
</div>
<div class="sect1">
<h2 id="_wildfly_patch">WildFly Patch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As usual, a <a href="http://download.jboss.org/weld/3.0.0.Alpha14/wildfly-10.0.0.CR4-weld-3.0.0.Alpha14-patch.zip">patch for WildFly</a> is available. This patch not only upgrades Weld within an existing WildFly instance but also upgrades CDI API to 2.0 EDR1. This time the target platform is <strong>WildFly 10.0.0.CR4</strong>.  If you’re not familiar with patching WildFly, check <a href="http://blog.eisele.net/2015/02/playing-with-weld-probe-see-all-of-your.html">Markus&#8217;s tutorial</a>.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327856">Release notes</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha14/weld-3.0.0.Alpha14.zip">Distribution</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha14/wildfly-10.0.0.CR4-weld-3.0.0.Alpha14-patch.zip">Patch for Wildfly 10 CR4</a>
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2015/08/05/weld-300Alpha12/">Weld 3.0.0.Alpha12 - CDI 2.0 EDR1 Reference Implementation!</a>
</h2>
<div class="news-date news-boxed">
2015-8-5
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Martin Kouba
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Weld 3.0.0.Alpha12 has been released. Compared to previous alpha releases this is an important milestone - it&#8217;s a reference implementation of <a href="http://docs.jboss.org/cdi/spec/2.0.EDR1/cdi-spec.html">CDI 2.0 Early Draft</a> (EDR1). You can read more about CDI 2.0 EDR1 on the official blog: <a href="http://www.cdi-spec.org/news/2015/07/03/CDI-2_0-EDR1-released/">CDI 2.0 Early Draft Review 1 released</a>.</p>
</div>
<div class="sect1">
<h2 id="_bootstrapping_a_cdi_container_in_java_se">Bootstrapping a CDI container in Java SE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting a CDI container is now really that easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static void main(String... args) {&#x000A;    try(CDI&lt;Object&gt; cdi = CDI.getCDIProvider().initialize()) {&#x000A;        ComputingService service = cdi.select(ComputingService.class).get();&#x000A;        service.compute();&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>javax.enterprise.inject.spi.CDI</code> now implements <code>AutoCloseable</code> and can therefore be used in a <code>try-with-resources</code> block.</p>
</div>
<div class="paragraph">
<p>Note that the specification of the bean discovery process in Java SE is not finished yet. Therefore, bean archives which don&#8217;t contain a beans.xml file are not supported. The main reason is that we don&#8217;t want to implement a feature which is being discussed and will likely undergo some important changes. Nevertheless, the feature will be implemented in one of the next alpha versions.</p>
</div>
<div class="sect2">
<h3 id="_weld_se_bootstrap_api">Weld SE bootstrap API</h3>
<div class="paragraph">
<p>How does it compare to Weld SE bootstrap API? Weld has provided support for the Java SE environment for a long time. Recently, the <code>org.jboss.weld.environment.se.Weld</code> class was turned into a powerful builder which allows to configure the Weld container before it is initialized.</p>
</div>
<div class="paragraph">
<p>Typical usage of the Weld SE API looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">try (WeldContainer container = new Weld().initialize()) {&#x000A;    ComputingService service = container.select(ComputingService.class).get();&#x000A;    service.compute();&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This looks very similar to CDI SE, right? However, there are several advanced feratures available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>automatic scanning can be disabled, classes or packages can be selected explicitly</p>
<div class="ulist">
<ul>
<li>
<p><code>WeldContainer container = new Weld().disableDiscovery().beanClasses(Foo.class, Bar.class).alternatives(Bar.class).interceptors(FooInterceptor.class).initialize();</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>WeldContainer allows to fire events easily</p>
<div class="ulist">
<ul>
<li>
<p><code>container.event().select(Bar.class).fire(new Bar());</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Weld-specific <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/configure.html#_weld_configuration">configuration options</a> can be specified using the builder</p>
</li>
<li>
<p>it is possible to start multiple independent Weld instances (specification does not require this)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also <a href="http://weld.cdi-spec.org/news/2015/04/21/weld-300Alpha8/">Weld 3.0.0.Alpha8 announcement</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asynchronous_events">Asynchronous Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An experimental support of asynchronous events is implemented in Weld since 3.0.0.Alpha3. However, in this release the API was aligned with CDI 2.0 EDR1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">class OrderProcessor {&#x000A;&#x000A;    @Inject Event&lt;Order&gt; orderEvent;&#x000A;&#x000A;    public void process(Order order) {&#x000A;        orderEvent.fireAsync(order).thenAccept((o)-&gt;System.out.println("Asynchronous processing finished: " + o.getId()));&#x000A;    }&#x000A;&#x000A;    public void processingOrder(@Observes Order event) {&#x000A;        // This observer is notified synchronously, before the fireAsync() method returns&#x000A;    }&#x000A;&#x000A;    public void asyncProcessingOrder(@ObservesAsync Order event) {&#x000A;        // This observer is notified asynchronously, in a different thread&#x000A;    }&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are few important things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the event was triggered with <code>fireAsync()</code></p>
</li>
<li>
<p>the asynchronous observer is defined by <code>@ObservesAsync</code></p>
<div class="ulist">
<ul>
<li>
<p>this is required because of backward compatibilty with previous versions of CDI, see also <a href="http://www.cdi-spec.org/news/2015/07/03/CDI-2_0-EDR1-released/#_why_this_double_activation_is_needed">Why this double activation is needed?</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>synchronous observers defined by <code>@Observes</code> are also notified!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To sum it up:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event method</th>
<th class="tableblock halign-left valign-top"><code>@Observes</code> notified</th>
<th class="tableblock halign-left valign-top"><code>@ObservesAsync</code> notified</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fire()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, in the same thread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fireAsync()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, in the same thread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, in a different thread</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_observers_spi_changes">Observers SPI Changes</h3>
<div class="paragraph">
<p><code>javax.enterprise.inject.spi.ObserverMethod</code> now extends <code>javax.enterprise.inject.spi.Prioritized</code> and overrides the <code>ObserverMethod.getPriority()</code> method which is used to determine the notification order in which the event observer methods are invoked. <code>Prioritized</code> interface is currently only used for observers. However, the Weld team is working on a prototype where <code>Prioritized</code> can be used to globally select/enable custom alternative beans, interceptors and decorators, see also <a href="https://issues.jboss.org/browse/WELD-2000">WELD-2000</a>.</p>
</div>
<div class="paragraph">
<p>Furthermore, <code>ObserverMethod.isAsync()</code> method was added to determine whether an observer method is asynchronous or not.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wildfly_patch">WildFly Patch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As usual, a <a href="http://download.jboss.org/weld/3.0.0.Alpha12/wildfly-10.0.0.Alpha6-weld-3.0.0.Alpha12-patch.zip">patch for WildFly</a> is available. This patch not only upgrades Weld within an existing WildFly instance but also upgrades CDI API to 2.0 EDR1. This time the target platform is <strong>WildFly 10.0.0.Alpha6</strong>.  If you’re not familiar with patching WildFly, check <a href="http://blog.eisele.net/2015/02/playing-with-weld-probe-see-all-of-your.html">Markus&#8217;s tutorial</a>.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12327471">Release notes</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha12/weld-3.0.0.Alpha12.zip">Distribution</a> &#93;
&#91; <a href="http://download.jboss.org/weld/3.0.0.Alpha12/wildfly-10.0.0.Alpha6-weld-3.0.0.Alpha12-patch.zip">Patch for Wildfly 10 Alpha</a>
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2015/04/21/weld-300Alpha8/">Weld 3.0.0.Alpha8</a>
</h2>
<div class="news-date news-boxed">
2015-4-21
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Jozef Hartinger
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Weld 3.0.0.Alpha8 has been released.
The main change is the enhanced API for using Weld in Java SE environment. In addition, this release comes with several weld-probe improvements.</p>
</div>
<div class="sect1">
<h2 id="_enhanced_api_for_weld_se">Enhanced API for Weld SE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Weld has provided <a href="http://docs.jboss.org/weld/reference/latest-2.2/en-US/html/environments.html#_java_se">support for the Java SE environment</a> for a long time with the weld-se module.
The API provides an easy way for an application to initialize Weld and use it in a standalone mode.
On initialization Weld SE scans the classpath for bean archives with the <code>beans.xml</code> file, similarly to how it&#8217;s done in the Java EE environment.</p>
</div>
<div class="paragraph">
<p>In this release we are extending the API further.
This is partially inspired by the current discussion in the CDI expert group where a standardized CDI API for Java SE is being proposed as part of <a href="https://issues.jboss.org/browse/CDI-26">CDI-26</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the new API in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Weld builder = new Weld()&#x000A;    .disableDiscovery()&#x000A;    .packages(Main.class, Utils.class)&#x000A;    .interceptors(TransactionalInterceptor.class)&#x000A;    .property("org.jboss.weld.construction.relaxed", true);&#x000A;&#x000A;try (WeldContainer weld = builder.initialize()) {&#x000A;    MyBean bean = weld.select(MyBean.class).get();&#x000A;    System.out.println(bean.computeResult());&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several new things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>Weld</code> class is used as a builder to configure Weld before it is initialized</p>
</li>
<li>
<p>automatic scanning can be disabled</p>
</li>
<li>
<p>instead of scanning, classes or packages can be selected explicitly. All classes in those packages will be managed by Weld</p>
</li>
<li>
<p>interceptors, decorators, extensions and <a href="http://docs.jboss.org/weld/reference/3.0.0.Alpha8/en-US/html/configure.html#_weld_configuration">Weld-specific configuration options</a> can be specified using the builder</p>
</li>
<li>
<p><code>WeldContainer</code> now implements <code>AutoCloseable</code> and can therefore be used in a <code>try-with-resources</code> block. At any time that execution gets outside of the code block, the Weld instance is shut down and all managed instances are safely destroyed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to start multiple independent Weld instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">new Weld().disableDiscovery().containerId("one").beanClasses(MyBean.class).initialize();&#x000A;new Weld().disableDiscovery().containerId("two").beanClasses(OtherBean.class).initialize();&#x000A;&#x000A;MyBean bean = WeldContainer.instance("one").select(MyBean.class).get();&#x000A;System.out.println(bean.computeResult());&#x000A;&#x000A;WeldContainer.instance("one").shutdown();&#x000A;WeldContainer.instance("two").shutdown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, two independent <code>WeldContainer</code> instances are initialized.
Each of them is given a unique ID.
The ID can subsequently be used to obtain a <code>WeldContainer</code> reference in a different place of the code.
One possible use-case this enables is for a library or framework (e.g. a testing framework) to use an embedded instance of Weld internally for its own needs (dependency injection, events, extensibility).
This instance would not interfere with the Weld instance used by the application.</p>
</div>
<div class="paragraph">
<p>Obviously, automatic classpath scanning can still be used as before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">try (WeldContainer weld = new Weld().enableDiscovery().initialize()) {&#x000A;    MyBean bean = weld.select(MyBean.class).get();&#x000A;    System.out.println(bean.computeResult());&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Update:</strong></p>
</div>
<div class="paragraph">
<p>To play with the new API use the following dependency in you Maven project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;&#x000A;    &lt;groupId&gt;org.jboss.weld.se&lt;/groupId&gt;&#x000A;    &lt;artifactId&gt;weld-se-core&lt;/artifactId&gt;&#x000A;    &lt;version&gt;3.0.0.Alpha8&lt;/version&gt;&#x000A;&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aforementioned classes are from the <code>org.jboss.weld.environment.se</code> package.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_weld_probe_enhancements">Weld Probe Enhancements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the last Alpha releases there were several enhancements to Weld Probe.
If you are not familiar with Weld Probe, check this <a href="http://weld.cdi-spec.org/news/2015/02/05/weld-300Alpha4/">introductory blog post first</a>.</p>
</div>
<div class="paragraph">
<p>A new feature of Probe is that, when the development mode is enabled, it now embeds a tiny information bar directly into the application&#8217;s HTML output.
That makes it easy to navigate to Probe directly from the application anytime.
Furthermore, if invocation tracking is enabled, the information bar helps navigate directly to the invocation tree related to the request that rendered the output.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/blog/probe-bar.png" alt="Weld Probe information bar embedded in application&#8217;s HTML output">
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
<div class="paragraph">
<p>Additionally, the following Probe improvements were implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tracked invocations are now grouped into a invocation tree instead of being tracked in isolation</p>
</li>
<li>
<p>a special type of edges is now used in the overview graph to represent a "declared by" relation (when a bean declares a producer method or field)</p>
</li>
<li>
<p>Instance&lt;?&gt; injection points are now treated specially - a resolved bean is show as injection point&#8217;s dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See this <a href="http://probe-weld.itos.redhat.com/weld-numberguess">live demo</a> and try Weld Probe yourself.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12326881">Release notes</a> &#93;
&#91; <a href="https://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha8">Distribution</a> &#93;
&#91; Patch for Wildfly
(<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha8/wildfly-8.2.0.Final-weld-3.0.0.Alpha8-patch.zip/download">8.2</a>,
<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha8/wildfly-9.0.0.Beta2-weld-3.0.0.Alpha8-patch.zip/download">9 Beta</a>)
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2015/02/25/weld-300Alpha5/">Weld 3.0.0.Alpha5</a>
</h2>
<div class="news-date news-boxed">
2015-2-25
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Jozef Hartinger
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Weld 3.0.0.Alpha5, the latest release in the series of CDI 2.0 prototypes, has been released.
The highlights of the release include new Bean builder API and many improvements to Weld Probe.</p>
</div>
<div class="sect1">
<h2 id="_bean_builder_api">Bean Builder API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The common way for frameworks and libraries to expose their API to applications via CDI is by using producer methods.
An alternative approach is a custom implementation of the <code>javax.enterprise.inject.spi.Bean</code> interface that is registered by a CDI portable extension.
This latter approach gives the extension more control but is also less straightforward.</p>
</div>
<div class="paragraph">
<p>One of the goals of CDI 2.0 is to fill this gap and simplify extension development.
This Weld release comes with a preview of the <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/BeanBuilder.html">Bean builder API</a>.
The API is inspired by Bean builder
<a href="http://deltaspike.apache.org/javadoc/1.2.1/org/apache/deltaspike/core/util/bean/BeanBuilder.html">API provided by DeltaSpike</a>.
In addition, Java 8 lambdas are used in the API to simplify the entire process even further.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a simple extension that builds and registers a bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">void register(@Observes ExperimentalAfterBeanDiscovery event) {&#x000A;    event.addBean()&#x000A;        .addType(Integer.class)&#x000A;        .addQualifier(Random.LITERAL)&#x000A;        .produceWith(() -&gt; new java.util.Random().nextInt(1000));&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it!
Likewise, it is easy to can define a bean with custom disposal logic using a lambda expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">void register(@Observes ExperimentalAfterBeanDiscovery event) {&#x000A;    event.addBean()&#x000A;        .addType(Connection.class)&#x000A;        .produceWith(this::newConnection)&#x000A;        .disposeWith(connection -&gt; connection.close());&#x000A;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/BeanBuilder.html">BeanBuilder Javadoc</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event_monitoring_with_probe">Event monitoring with Probe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We introduced Probe in the <a href="http://weld.cdi-spec.org/news/2015/02/05/weld-300Alpha4/">previous blog post</a>.
This release adds event monitoring view to Probe.
In this view both system and application events are displayed.
The events can be filtered by type and qualifiers.
It is also possible to track which observer methods a particular event was delivered to.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/blog/probe-events.png" alt="Weld Probe event monitoring">
</div>
</div>
<div class="sect2">
<h3 id="_further_improvements">Further improvements</h3>
<div class="paragraph">
<p>In addition, there were a couple of minor improvements to Probe, namely:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>better filtering of invocation trees - Probe now searches the whole tree, not just the entry points</p>
</li>
<li>
<p>the context view now displays the conversation context</p>
</li>
<li>
<p>Probe is now more careful and does not try to bind interceptors to classes that are not proxyable</p>
</li>
<li>
<p>all the configuration options for Probe are now <a href="http://docs.jboss.org/weld/reference/3.0.0.Alpha5/en-US/html/configure.html#config-dev-mode">documented</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you haven&#8217;t tried Probe yet check this <a href="http://probe-weld.itos.redhat.com/weld-numberguess/weld-probe#/events">demo running on OpenShift</a>.
The easiest way to get Probe to run locally is to patch WildFly with a <a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha5">Weld patch</a>.
If you&#8217;re not familiar with patching WildFly, check <a href="http://blog.eisele.net/2015/02/playing-with-weld-probe-see-all-of-your.html">Markus&#8217;s tutorial</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relaxed_construction">Relaxed construction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CDI requires that beans that are normal-scoped, intercepted or decorated always define a no-argument constructor.
This requirement applies even if the bean already defines an @Inject annotated constructor with parameters.
This is purely a technical requirement implied by how Java allocates class instances.</p>
</div>
<div class="paragraph">
<p>Weld is however able to operate fine even if this requirement is not met.
Weld uses special non-portable JVM APIs that allow it to allocate proxy instances without calling proxy’s constructor.
This mode is non-portable and needs to be <a href="http://docs.jboss.org/weld/reference/3.0.0.Alpha5/en-US/html/configure.html#relaxedConstruction">explicitly enabled using a configuration option</a>.</p>
</div>
<div class="paragraph">
<p>This mode is not new but has been neglected in the past.
For this release we added a bunch of tests for this mode, fixed a lot of bugs and enabled it by default in Weld-SE.
Any feedback on this mode is appreciated.</p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12326167">Release notes</a> &#93;
&#91; <a href="https://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha5">Distribution</a> &#93;
&#91; Patch for Wildfly
(<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha5/wildfly-8.2.0.Final-weld-3.0.0.Alpha5-patch.zip/download">8.2</a>,
<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha5/wildfly-9.0.0.Alpha1-weld-3.0.0.Alpha5-patch.zip/download">9 Alpha</a>)
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2015/02/05/weld-300Alpha4/">Weld 3.0.0.Alpha4</a>
</h2>
<div class="news-date news-boxed">
2015-2-5
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/release">release</a>
, 
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Jozef Hartinger
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Here we are again with the next Alpha release of Weld 3.
This time there are no additional CDI 2.0 previews.
Instead, this release contains multiple performance improvements, enables <code>@Asynchronous</code>
calls to be implemented simply with CDI interceptors and most importantly, it comes with
<strong>weld-probe</strong>.</p>
</div>
<div class="sect1">
<h2 id="_weld_probe">Weld Probe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Why isn&#8217;t my field injected?
Why isn&#8217;t my interceptor triggered?
What extensions do third-party libraries register?</p>
</div>
<div class="paragraph">
<p>Have you ever found yourself asking a similar question?
Making Weld developer-friendly and helpful in troubleshooting is our priority.
Yet, similar problems still occur sometimes.</p>
</div>
<div class="paragraph">
<p>But we can do event better! In Alpha4 of Weld 3 we are introducing a new tool called <strong>Weld Probe</strong>.
Probe is a built-in tool that provides a detailed view into internals of a CDI application.
Weld Probe has a web UI and is provided out-of-the-box.</p>
</div>
<div class="paragraph">
<p>Probe makes it easy to inspect:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>beans, their properties such as qualifiers, stereotypes and name</p>
</li>
<li>
<p>a graph of bean dependencies</p>
</li>
<li>
<p>observers and producers declared by beans</p>
</li>
<li>
<p>interceptors and decorators bound to a bean</p>
</li>
<li>
<p>extensions</p>
</li>
<li>
<p>information about current contextual instances</p>
</li>
<li>
<p>tracking of invocations and invocation trees</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Plus more addons are planned in future.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://developer.jboss.org/servlet/JiveServlet/showImage/38-5641-24345/probe_bean_detail.png" alt="Weld Probe Screenshot">
</div>
</div>
<div class="paragraph">
<p>To try probe all that needs to be done is to upgrade to Alpha4, enable the development mode and point your browser to the URL
of your CDI application plus <code>/weld-probe</code> suffix.</p>
</div>
<div class="paragraph">
<p>For more thorough overview of what Probe provides see
<a href="http://goo.gl/ICQrRA">Martin&#8217;s blog post</a> or the
<a href="http://docs.jboss.org/weld/reference/3.0.0.Alpha4/en-US/html/devmode.html#_probe">reference documentation</a>.
You can play with Probe using this
<a href="http://probe-weld.itos.redhat.com/weld-numberguess">simple CDI application</a>
hosted on <a href="https://www.openshift.com/">OpenShift</a>. Just append
<a href="http://probe-weld.itos.redhat.com/weld-numberguess/weld-probe">/weld-probe</a>
to the URL.</p>
</div>
<div class="paragraph">
<p>Bear in mind that Probe is still work in progress and that this early preview may have defects
here and there.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_asynchronous_using_cdi_interceptor">Implementing @Asynchronous using CDI interceptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It <strong>is</strong> possible to implement a substitute for EJB <code>@Asynchronous</code> method calls using CDI interceptors.
Arjan Tijms recently <a href="http://jdevelopment.nl/cdi-based-asynchronous-alternative/">blogged about his solution</a>
A similar one can be found in
<a href="https://github.com/weld/core/blob/master/tests-arquillian/src/test/java/org/jboss/weld/tests/interceptors/thread/async/AsyncInterceptor.java">Weld&#8217;s testsuite</a>.
Long story short: This would not work smoothly until now because of a limitation in Weld. This limitation is now gone in Alpha4.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance">Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release integrates various runtime performance improvements mainly around bean instance construction,
producer and observer method invocation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next">Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Weld 3.0.0.Alpha5 is planned in 3 weeks time from now, with some more CDI 2.0 previews.
We are going to continue releasing Alpha versions of Weld 3.0 roughly every 3 weeks until
the early draft of CDI 2.0, which should happen sometime in March.
At that point, we&#8217;ll move to Beta releases.</p>
</div>
<div class="paragraph">
<p>In the meantime, we&#8217;d like to hear your feedback on Probe or on Weld 3.0 Alpha releases in general.
Feel free to use our <a href="https://community.jboss.org/en/weld?view=discussions">forums</a> or <a href="http://webchat.freenode.net/?channels=weld-dev">#weld-dev on freenode</a></p>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12326166">Release notes</a> &#93;
&#91; <a href="https://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha4">Distribution</a> &#93;
&#91; Patch for Wildfly
(<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha4/wildfly-8.2.0.Final-weld-3.0.0.Alpha4-patch.zip/download">8.2</a>,
<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha4/wildfly-9.0.0.Alpha1-weld-3.0.0.Alpha4-patch.zip/download">9 Alpha</a>)
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="post">
<h2>
<a href="/news/2014/12/10/an-update-on-weld-3/">An update on Weld 3</a>
</h2>
<div class="news-date news-boxed">
2014-12-10
&nbsp;
<span class="tags">
<i class="fa fa-tags"></i>
<a href="/news/tags/cdi2">cdi2</a>
</span>
&nbsp;
<i class="fa fa-pencil"></i>
Jozef Hartinger
</div>
<p></p>
<div class="content">
<div class="paragraph">
<p>Today we are releasing the third Alpha release of Weld 3. These Alpha releases serve
as prototypes of changes currently being discussed by the CDI expert group for
the upcoming CDI 2.0.</p>
</div>
<div class="paragraph">
<p>The Alpha releases are not suitable for production use as the new API and functionality
are still subject to change. We are releasing them to allow the community to test-drive
the changes early in the development cycle. We want to shorten the feedback loop and
identify possible glitches as soon as possible.</p>
</div>
<div class="paragraph">
<p>Let’s just quickly review what has been available since Alpha1:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>declarative ordering of observer methods using <code>@Priority</code></p>
</li>
<li>
<p>ability for an extension to veto and modify an observer method</p>
</li>
<li>
<p>support for Java 8 repeatable annotations as qualifiers and interceptor bindings</p>
</li>
<li>
<p>enhanced <code>AnnotatedType</code> API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details and examples of these features see my
<a href="http://weld.cdi-spec.org/news/2014/10/02/weld-300Alpha1/">previous blog post</a>.</p>
</div>
<div class="paragraph">
<p>On top of this, we’re now adding the <strong>following new features and enhancements</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>asynchronous events</p>
</li>
<li>
<p>simplified configuration of Weld-specific properties</p>
</li>
<li>
<p>Guava is no longer used internally</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_asynchronous_events">Asynchronous events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since its first version CDI has provided events as a facility for component interaction.
Events enable loose coupling while preserving type safety.
So far, CDI has supported synchronous delivery of events - the calling thread blocks
until invocations of all associated observer methods complete. An alternative to
this are transactional observer methods which are called asynchronously at the end
of a transaction.</p>
</div>
<div class="paragraph">
<p>For the upcoming CDI 2.0 specification one of the hot topics is enhancement of the
events facility. The expert group is
<a href="https://docs.google.com/document/d/1pDO7gru6YuEyTDdK3XBozvXZYucT9uC7McZMffSZun4/edit?usp=sharing">considering adding fully asynchronous event dispatching mechanism</a>.</p>
</div>
<div class="paragraph">
<p>A working prototype of this is available in Weld 3.0.0.Alpha3. The current proposal
adds a method called <code>fireAsync</code> to the existing <code>Event</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Inject&#x000A;private ExperimentalEvent&lt;Configuration&gt; event;&#x000A;…&#x000A;event.fireAsync(new Configuration());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The call to <code>event.fireAsync()</code> returns immediately. The event is delivered to
corresponding observers in a dedicated thread pool that can be configured.</p>
</div>
<div class="sect2">
<h3 id="_what_about_thread_safety">What about thread-safety?</h3>
<div class="paragraph">
<p>There are two common usage pattens for events. In the first one an immutable event
object is used. An alternative is to use mutable events. A mutable event allows
observers to participate on the result which is later used by the component that
fired the event. An example of this would be the
<a href="https://docs.oracle.com/javaee/6/api/javax/enterprise/inject/spi/ProcessAnnotatedType.html">ProcessAnnotatedType&lt;T&gt;</a>
event used by CDI extensions. When events are fired synchronously, both
approaches work fine but how does this work when we switch to async?</p>
</div>
<div class="paragraph">
<p>Nothing changes actually. No matter if the event object is immutable or not, you
do not have to worry about thread-safety of the event object. The current implementation
comes with the guarantee that event object is safely published which means that
an observer method observes the event in the state in which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it was left by an observer executing before the given observer, or</p>
</li>
<li>
<p>the initial state of the event if the given observer is the first one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, the state is consistent throughout the execution of an observer method
which means that we guarantee safe publication and prevent races for you. The only
thing that should be avoided is modifying the state of the event object outside of
an observer method. This behavior matches the
<a href="https://docs.google.com/document/d/1lFtgLm6hY-uECdA1r0Sfimq6vkVYThoUZsevPUaSP0E/edit?usp=sharing">option 4.1.1.1 in the current spec proposal</a>.</p>
</div>
<div class="paragraph">
<p>Update: new <a href="https://docs.google.com/document/d/1pDO7gru6YuEyTDdK3XBozvXZYucT9uC7McZMffSZun4/edit?usp=sharing">link for a planning document</a></p>
</div>
<div class="paragraph">
<p>In addition, if observer methods are ordered (another new feature proposed for CDI 2.0)
we preserve the ordering (as in such situation the observers are ordered for a reason!)
and invoke observers in the given order.</p>
</div>
<div class="paragraph">
<p>Last but not least, if an observer is transactional, we again preserve this and
invoke the observer method in the corresponding transaction phase.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_i_know_when_event_delivery_finishes_and_what_about_exceptions">How do I know when event delivery finishes and what about exceptions?</h3>
<div class="paragraph">
<p>In the current prototype we’re reusing the
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletionStage.html">CompletionStage</a>
API, introduced in Java 8, which allows actions (callbacks) to be bound to the completion of the
asynchronous delivery process. This is what it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">event.fireAsync(new Configuration()).thenAccept(config -&gt; master.compute(config));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This piece of code starts with asynchronously firing a mutable configuration object
allowing loosely-coupled observers to alter the configuration of a computation.
Once all observers finish, computation is initiated based on the resulting configuration.</p>
</div>
<div class="paragraph">
<p>If an exception occurs this can be dealt with also, either by falling back to a default value</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">event.fireAsync(new Configuration())&#x000A;    .exceptionally(throwable -&gt; DEFAULT_CONFIGURATION)&#x000A;    .thenAccept((config) -&gt; master.compute(config));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or by executing arbitrary code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">event.fireAsync(new Configuration()).whenComplete((config, throwable) -&gt; {&#x000A;    if (throwable != null) {&#x000A;        System.err.println("Oops. Failed because of " + throwable.getMessage());&#x000A;    } else {&#x000A;        master.compute(config);&#x000A;    }&#x000A;});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CompletionStage</code> allows much more. If you are unfamiliar with the API see the
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletionStage.html">Javadoc</a>
page for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_i_try_this_myself">How do I try this myself?</h3>
<div class="paragraph">
<p>It’s easy and multiple options are available. First of them is to use Weld in a
<strong>standalone application</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Java SE application.</p>
</li>
<li>
<p>Add dependency on Weld</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">&lt;dependency&gt;&#x000A;    &lt;groupId&gt;org.jboss.weld.se&lt;/groupId&gt;&#x000A;    &lt;artifactId&gt;weld-se-core&lt;/artifactId&gt;&#x000A;    &lt;version&gt;3.0.0.Alpha3&lt;/version&gt;&#x000A;&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create an empty <code>beans.xml</code> file, e.g.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">mkdir src/main/resources/META-INF&#x000A;touch src/main/resources/META-INF/beans.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Launch Weld and fire an event asynchronously</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static void main(String[] args) {&#x000A;    WeldContainer weld = new Weld().initialize();&#x000A;    Event&lt;String&gt; evnt = weld.event().select(String.class);&#x000A;    ExperimentalEvent&lt;String&gt; event = (ExperimentalEvent&lt;String&gt;) evnt;&#x000A;&#x000A;    event.fireAsync("message");&#x000A;}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_wildfly">WildFly</h4>
<div class="paragraph">
<p>Alternatively, a patch is available for WildFly that upgrades Weld within an existing WildFly instance. See the
<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha3">download page</a>
for more details.</p>
</div>
<div class="paragraph">
<p>Note that these new prototyped APIs are not part of the CDI API yet. Instead, they are currently located
in
<a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.jboss.weld%22%20AND%20a%3A%22weld-api%22">Weld API</a>
in a package named
<a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">org.jboss.weld.experimental</a></p>
</div>
<div class="paragraph">
<p>All these altered APIs have the <code>Experimental</code> prefix (that&#8217;s why we are using <code>ExperimentalEvent</code> in the examples)</p>
</div>
<div class="paragraph">
<p><strong>We would appreciate your feedback!</strong> Feel free to use
<a href="https://community.jboss.org/en/weld?view=discussions">Weld forums</a>
or the
<a href="https://lists.jboss.org/mailman/listinfo/cdi-dev">cdi-dev mailing list</a>
for this purpose.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next">What’s next?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to continue releasing early prototypes of features currently proposed for
CDI 2.0. The plan is to release a new Alpha version every 3 weeks. There are several
areas we want to focus on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>simplifying how extensions register beans and observers</p>
</li>
<li>
<p>monitoring and debugging of CDI applications</p>
</li>
<li>
<p>experimenting with full interception (intercepting even calls within a given component)</p>
</li>
<li>
<p>splitting the codebase into a “light” and “full” version (to support proposed <strong>CDI light</strong> version)</p>
</li>
<li>
<p>bootstrap API for SE environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#91; <a href="http://docs.jboss.org/weld/javadoc/3.0/weld-api/org/jboss/weld/experimental/package-frame.html">Experimental API documentation</a> &#93;
&#91; <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310891&amp;version=12325836">Release notes</a> &#93;
&#91; <a href="https://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha3">Distribution</a> &#93;
&#91; Patch for Wildfly
(<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha3/wildfly-8.2.0.Final-weld-3.0.0.Alpha3-patch.zip/download">8.2</a>,
<a href="http://sourceforge.net/projects/jboss/files/Weld/3.0.0.Alpha3/wildfly-9.0.0.Alpha1-weld-3.0.0.Alpha3-patch.zip/download">9 Alpha</a>)
&#93;</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div class="pagination-links"><span class="current-page">1</span> </div>
<hr>
<div>
<a href="http://weld.cdi-spec.org/news.atom">
<i class="fa fa-rss"></i>
Subscribe to Weld news
</a>
</div>

</div>
</div>
</div>
</div>
</div>
<footer>
<div class="row">
<div class="container" id="companyfooter">
<div class="redhatlogo" style="text-align:center;">
<div class="logospacer" style="height:10px;"></div>
<a href="http://www.redhat.com/">
<img src="https://static.jboss.org/theme/images/common/redhat_logo.png">
</a>
</div>
</div>
</div>
</footer>
</body>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount','UA-45187401-1']);
_gaq.push(['_trackPageview']);
(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<script>
  $(document).ready(function() {
    $('#toggle_menu').click(function(){
      $("#mobile_menu").toggle();
    });
  });
</script>
</html>
