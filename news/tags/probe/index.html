<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Weld: News - tagged as &quot;probe&quot;
    </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Latest news about Weld." name="description">
    <link href="/images/weld_icon_32x.ico" rel="shortcut icon" type="image/x-icon">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//static.jboss.org/css/tabzilla.css" media="screen" rel="stylesheet" type="text/css">
    <link href="http://weld.cdi-spec.org/stylesheets/styles.css" rel="stylesheet" type="text/css">
    <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="//static.jboss.org/js/_jbossorg-tabzilla.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <link href="http://weld.cdi-spec.org/news.atom" rel="alternate" type="application/atom+xml">
    <link href="//cdn.jsdelivr.net/highlight.js/8.9.1/styles/hybrid.min.css" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/highlight.js/8.9.1/highlight.min.js" type="text/javascript"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-2 col-sm-3">
          <div class="sidebar-nav">
            <div class="navbar navbar-default" role="navigation">
              <div class="navbar-header">
                <button ="button" class="navbar-toggle" data-target=".sidebar-navbar-collapse" data-toggle="collapse">
                  <span class="sr-only">
                    Toggle navigation
                  </span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a ="#" class="visible-xs navbar-brand">
                  <img alt="Weld Logo" src="/images/weld_logo_100x.png">
                </a>
              </div>
              <div class="collapse navbar-collapse sidebar-navbar-collapse">
                <ul class="nav navbar-nav">
                  <li>
                    <a href="/">
                      <i class="fa fa-home"></i>
                      &nbsp;Home
                    </a>
                  </li>
                  <li>
                    <a href="/download">
                      <i class="fa fa-download"></i>
                      &nbsp;Download
                    </a>
                  </li>
                  <li>
                    <a href="/news">
                      <i class="fa fa-newspaper-o"></i>
                      &nbsp;News
                    </a>
                  </li>
                  <li>
                    <a href="https://issues.jboss.org/projects/WELD?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page" target="_blank">
                      <i class="fa fa-road"></i>
                      &nbsp;Road Map
                    </a>
                  </li>
                  <li>
                    <a href="/documentation">
                      <i class="fa fa-book"></i>
                      &nbsp;Docs &amp; FAQ
                    </a>
                  </li>
                  <li>
                    <a href="/news/tags/tips">
                      <i class="fa fa-lightbulb-o"></i>
                      &nbsp;Tips and Tricks
                    </a>
                  </li>
                  <li>
                    <a href="/community">
                      <i class="fa fa-group"></i>
                      &nbsp;Community
                    </a>
                  </li>
                  <li>
                    <a href="http://github.com/weld" target="_blank">
                      <i class="fa fa-github-alt"></i>
                      &nbsp;Source Code
                    </a>
                  </li>
                  <li>
                    <a href="https://issues.jboss.org/browse/WELD#selectedTab=com.atlassian.jira.plugin.system.project%3Asummary-panel" target="_blank">
                      <i class="fa fa-tasks"></i>
                      &nbsp;Bug Tracker
                    </a>
                  </li>
                  <li>
                    <a href="https://twitter.com/jbossweld" target="_blank">
                      <i class="fa fa-twitter"></i>
                      &nbsp;Follow @jbossweld
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-10 col-sm-9">
          <div class="row hidden-xs">
            <div class="dropup">
              <div id="ajbossproject">
                A JBoss Project
              </div>
              <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
              <script>
                window.addEventListener('load', function() {renderTabzilla("Weld", "weld", false )}, false);
              </script>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <a href="/">
                <img alt="Weld Logo" class="hidden-xs weld-home-logo" src="/images/weld_logo_450x.png">
              </a>
            </div>
            <div class="col-md-8">
              <img alt="CDI tagcloud" class="hidden-xs hidden-sm cdi-background" src="/images/CDIbackground.png">
            </div>
          </div>
          <div class="row content-wrapper">
            <div class="col-md-12">
              <h1>
                News - tagged as &quot;probe&quot;
                <a href="http://weld.cdi-spec.org/news.atom">
                  <i class="fa fa-rss"></i>
                </a>
              </h1>
              <div class="post">
                <h2>
                  <a href="/news/2015/11/10/weld-probe-jmx/">Weld development mode and JMX support</a>
                </h2>
                <div class="news-date news-boxed">
                  2015-11-10
                  &nbsp;
                  <span class="tags">
                    <i class="fa fa-tags"></i>
                    <a href="/news/tags/probe">probe</a>
                    ,
                    <a href="/news/tags/jmx">jmx</a>
                  </span>
                  &nbsp;
                  <i class="fa fa-pencil"></i>
                  Martin Kouba
                </div>
                <p></p>
                <div class="content">
                  <div class="paragraph">
                  <p>Weld comes with a special mode for application development.
                  When enabled, some interesting data are collected so that it&#8217;s possible to inspect and monitor application components at runtime (see also <a href="http://probe-weld.itos.redhat.com/weld-numberguess/weld-probe">the demo application hosted on OpenShift</a>).
                  Data in JSON format are available through the REST API,  eventually through the MXBean of name <code>org.jboss.weld.probe:type=JsonData,context=ID</code> where ID should be replaced with an identifier of an application.
                  The JMX support might be especially useful for environments and applications which do not utilize a web container (Java SE, OSGi, etc.).</p>
                  </div>
                  <div class="sect1">
                  <h2 id="_how_to_enable_jmx_support">How to enable JMX support</h2>
                  <div class="sectionbody">
                  <div class="paragraph">
                  <p>Simply use the <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/configure.html#_weld_configuration">Weld configuration facility</a> and <code>org.jboss.weld.probe.jmxSupport</code> configuration property. If set to <code>true</code> one or more MBean components may be registered so that it is possible to use JMX to access the Probe development tool data.</p>
                  </div>
                  </div>
                  </div>
                  <div class="sect1">
                  <h2 id="_jmx_client">JMX client</h2>
                  <div class="sectionbody">
                  <div class="paragraph">
                  <p>So for example if using Weld SE without a web container it&#8217;s still possible to access the Probe data.
                  There is a lot of JMX clients out there (for example jconsole or jvisualvm from the Oracle JDK).
                  The problem is not all of us prefer reading JSON data.
                  Hey wait! Weld Probe already has an HTML client, right?
                  Yes, but this client works with REST API.
                  We would have to embed a web container (e.g. Undertow) and add Weld Servlet or do some configuration manually.
                  But what if there are multiple Weld instances in the same JVM? The configuration might become quite complex.
                  Luckily, there is another solution - a <strong>working prototype</strong> of <a href="https://github.com/weld/weld-probe-jmx">JMX client reusing the default HTML GUI</a>.</p>
                  </div>
                  <div class="sect2">
                  <h3 id="_clone_build_and_run">Clone, build and run</h3>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code>    # Clone the git repo&#x000A;        git clone git@github.com:weld/weld-probe-jmx.git&#x000A;        # Specify the weld version used in your application and run the build&#x000A;        mvn clean package -Dversion.weld=2.3.1.Final&#x000A;        # Run the client&#x000A;        java -jar target/weld-probe-jmx-1.0.0-SNAPSHOT-shaded.jar</code></pre>
                  </div>
                  </div>
                  </div>
                  <div class="sect2">
                  <h3 id="_how_does_it_work">How does it work?</h3>
                  <div class="ulist">
                  <ul>
                  <li>
                  <p>First, the client attempts to connect to a JMX server (your application)</p>
                  </li>
                  <li>
                  <p>User may select a Weld container to inspect</p>
                  </li>
                  <li>
                  <p>Then the client starts an Undertow instance locally, HTML client is available at: <a href="http://127.0.0.1:8181/probe-jmx/weld-probe" class="bare">http://127.0.0.1:8181/probe-jmx/weld-probe</a></p>
                  </li>
                  <li>
                  <p>Data are fetched remotely through JMX</p>
                  </li>
                  <li>
                  <p>User may reconnect at any time</p>
                  </li>
                  </ul>
                  </div>
                  <div class="paragraph">
                  <p>See also the JBoss Forge example below to see an example output.</p>
                  </div>
                  </div>
                  <div class="sect2">
                  <h3 id="_configuration">Configuration</h3>
                  <div class="paragraph">
                  <p>Moreover, it&#8217;s also possible to configure the JMX server URL, Undertow host and port - used to expose the HTML client. E.g. for WildFly (standalone mode) a different jmxServiceUrl must be specified and jboss-client.jar must be also on the class path, e.g.:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code>java -Dorg.jboss.weld.probe.jmxServiceUrl="service:jmx:http-remoting-jmx://127.0.0.1:9990" -cp '/opt/jboss/wildfly/bin/client/jboss-client.jar:target/weld-probe-jmx-1.0.0-SNAPSHOT-shaded.jar' org.jboss.weld.probe.ProbeJmx</code></pre>
                  </div>
                  </div>
                  </div>
                  </div>
                  </div>
                  <div class="sect1">
                  <h2 id="_jboss_forge_example">JBoss Forge example</h2>
                  <div class="sectionbody">
                  <div class="paragraph">
                  <p>An interesting use case would be to inspect JBoss Forge addons powered by CDI (works with <strong>Forge 2.20.1.Final</strong> and later).
                  Before we start Forge we need to set some extra system properties:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre class="highlightjs highlight"><code>export FORGE_OPTS="-Dorg.jboss.weld.development=true -Dorg.jboss.weld.probe.jmxSupport=true -Dorg.jboss.weld.probe.eventMonitor.containerLifecycleEvents=true -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"</code></pre>
                  </div>
                  </div>
                  <div class="paragraph">
                  <p>System properties starting with <code>com.sun.management</code> simply allow to connect to JMX remotely.
                  <code>org.jboss.weld.development</code> enables the development mode.
                  <code>org.jboss.weld.probe.jmxSupport</code> enables the JMX support.
                  Finally, If <code>org.jboss.weld.probe.eventMonitor.containerLifecycleEvents</code> is set to <code>true</code> all the container lifecycle events are monitored during bootstrap.</p>
                  </div>
                  <div class="paragraph">
                  <p>Then start the Forge as usually and run the prototype. You should see a similar output:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre>Connecting to a remote JMX server: service:jmx:rmi:///jndi/rmi://127.0.0.1:9999/jmxrmi&#x000A;    Select a Weld container (JSON data provider):&#x000A;    [0] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:shell_1447145001728"&#x000A;    [1] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:configuration_1447145001592"&#x000A;    [2] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:parser-java_1447145002037"&#x000A;    [3] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:bean-validation_1447145001526"&#x000A;    [4] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:javaee_1447145003135"&#x000A;    [5] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:ui_1447145001709"&#x000A;    [6] org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:convert_1447145001526"&#x000A;    &#x000A;    [disconnected]$</pre>
                  </div>
                  </div>
                  <div class="paragraph">
                  <p>Now select a Weld container to inspect, e.g. <code>5</code>:</p>
                  </div>
                  <div class="listingblock">
                  <div class="content">
                  <pre>[disconnected]$ 5&#x000A;    Connecting to the Weld container [5]: org.jboss.weld.probe:type=JsonData,context="org.jboss.forge.addon:ui_1447145001709"&#x000A;    Starting Undertow...&#x000A;    Lis 10, 2015 9:44:16 DOP. org.xnio.Xnio &lt;clinit&gt;&#x000A;    INFO: XNIO version 3.3.1.Final&#x000A;    Lis 10, 2015 9:44:16 DOP. org.xnio.nio.NioXnio &lt;clinit&gt;&#x000A;    INFO: XNIO NIO Implementation Version 3.3.1.Final&#x000A;    Weld Probe HTML client available at: http://127.0.0.1:8181/probe-jmx/weld-probe&#x000A;    &#x000A;    [connected #5]$</pre>
                  </div>
                  </div>
                  <div class="paragraph">
                  <p>The HTML client is available at <a href="http://127.0.0.1:8181/probe-jmx/weld-probe" class="bare">http://127.0.0.1:8181/probe-jmx/weld-probe</a>. It&#8217;s also possible to reconnect or exit. Type <code>help</code> to get a list of all possible commands.</p>
                  </div>
                  </div>
                  </div>
                </div>
                <hr>
              </div>
              <div class="pagination-links"><span class="current-page">1</span> </div>
              <hr>
              <div>
                <a href="http://weld.cdi-spec.org/news.atom">
                  <i class="fa fa-rss"></i>
                  Subscribe to Weld news
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        <div class="container" id="companyfooter">
          <div class="redhatlogo" style="text-align:center;">
            <div class="logospacer" style="height:10px;"></div>
            <a href="http://www.redhat.com/">
              <img src="http://static.jboss.org/theme/images/common/redhat_logo.png">
            </a>
          </div>
        </div>
      </div>
    </footer>
  </body>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount','UA-45187401-1']);
  _gaq.push(['_trackPageview']);
  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>
  <script>
    $(document).ready(function() {
      $('#toggle_menu').click(function(){
        $("#mobile_menu").toggle();
      });
    });
  </script>
</html>
