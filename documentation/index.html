<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Weld: Documentation
    </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- /If IE7 for font-awesome -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome-ie7.min.css" rel="stylesheet" type="text/css">
    <link href="http://weld.cdi-spec.org/stylesheets/styles.css" rel="stylesheet" type="text/css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <link href="http://weld.cdi-spec.org/news.atom" rel="alternate" type="application/atom+xml">
  </head>
  <body>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2" style="min-height:1px;">
          <ul class="nav nav-tabs nav-stacked span2 visible-desktop" id="main_nav">
            <li>
              <a href="/">
                <i class="icon-home"></i>
                Home
              </a>
            </li>
            <li>
              <a href="/download">
                <i class="icon-download"></i>
                Download
              </a>
            </li>
            <li>
              <a href="/news">
                <i class="icon-edit"></i>
                News
              </a>
            </li>
            <li>
              <a href="https://issues.jboss.org/browse/WELD#selectedTab=com.atlassian.jira.plugin.system.project%3Aroadmap-panel">
                <i class="icon-road"></i>
                Road map
              </a>
            </li>
            <li>
              <a href="/documentation">
                <i class="icon-book"></i>
                Docs &amp; FAQ
              </a>
            </li>
            <li>
              <a href="/community">
                <i class="icon-group"></i>
                Community
              </a>
            </li>
            <li>
              <a href="http://github.com/weld">
                <i class="icon-github-alt"></i>
                Source code
              </a>
            </li>
            <li>
              <a href="https://issues.jboss.org/browse/WELD#selectedTab=com.atlassian.jira.plugin.system.project%3Asummary-panel">
                <i class="icon-tasks"></i>
                Bug tracker
              </a>
            </li>
          </ul>
          <a class="hidden-desktop" href="#" id="toggle_menu">
            <i class="icon-exchange"></i>
          </a>
          <ul class="nav nav-tabs nav-stacked span2 hide hidden-desktop" id="mobile_menu">
            <li>
              <a href="/">
                <i class="icon-home"></i>
                Home
              </a>
            </li>
            <li>
              <a href="/download">
                <i class="icon-download"></i>
                News
              </a>
            </li>
            <li>
              <a href="/roadmap">
                <i class="icon-road"></i>
                Road map
              </a>
            </li>
            <li>
              <a href="/documentation">
                <i class="icon-book"></i>
                Documentation
              </a>
            </li>
            <li>
              <a href="/community">
                <i class="icon-group"></i>
                Community
              </a>
            </li>
            <li>
              <a href="http://github.com/weld">
                <i class="icon-github-alt"></i>
                Source code
              </a>
            </li>
            <li>
              <a href="https://jira.jboss.org/jira/browse/WELD">
                <i class="icon-tasks"></i>
                Bug tracker
              </a>
            </li>
            <li>
              <a href="/governance"></a>
              <i class="icon-edit">
                Governance
              </i>
            </li>
          </ul>
        </div>
        <div class="span10">
          <div class="row">
            <div class="span4">
              <img alt="Weld Logo" class="weld-home-logo" src="/images/weld_logo_450x.png">
            </div>
            <div class="span8">
              <img alt="CDI tagcloud" class="cdi-background" src="/images/CDIbackground.png">
            </div>
          </div>
          <div class="row-fluid">
            <div class="span10">
              <h1>Documentation</h1>
              <p>Weld reference documentation can be viewed online or downloaded as a PDF.</p>
              <ul>
                <li>
                  The latest version:
                  <ul>
                    <li>
                      <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/">HTML</a>
                    </li>
                    <li>
                      <a href="http://docs.jboss.org/weld/reference/latest/en-US/html_single/">HTML (Single page)</a>
                    </li>
                    <li>
                      <a href="http://docs.jboss.org/weld/reference/latest/en-US/pdf/weld-reference.pdf">PDF</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="http://docs.jboss.org/weld/reference/" target="_blank">Browse all Weld reference documentation</a>
                </li>
              </ul>
              <h1>FAQ</h1>
              <ul>
                <li>
                  <a href="#0">
                    If I create a thread in my CDI bean, how will Weld react?
                  </a>
                </li>
                <li>
                  <a href="#1">
                    Why does Weld leave some proxy class definitions lying around when I undeploy my application? How can I prevent this?
                  </a>
                </li>
                <li>
                  <a href="#2">
                    Some of my beans aren&#8217;t deployed and I can&#8217;t see why?
                  </a>
                </li>
                <li>
                  <a href="#3">
                    Why does Weld set character encoding of an HTTP request/response body to ISO-8859-1?
                  </a>
                </li>
                <li>
                  <a href="#4">
                    My application bundles a third-party library which uses javax.inject annotations. This library was not intended to be a CDI library but on CDI 1.1 this library is being picked up as an implicit bean archive and breaks the deployment of my application. Why is this happening?
                  </a>
                </li>
                <li>
                  <a href="#5">
                    How can I bundle my entire SE application with Weld into a single jar?
                  </a>
                </li>
                <li>
                  <a href="#6">
                    I use the Instance API to obtain bean instances. Why does it seem to cause a memory leak?
                  </a>
                </li>
                <li>
                  <a href="#7">
                    How do I change the log level for Weld in a specific container?
                  </a>
                </li>
              </ul>
              <hr>
              <div id="0">
                <h3>
                  If I create a thread in my CDI bean, how will Weld react?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>Weld assumes requests are single threaded, and uses thread locals to isolate requests. This means that if user created threads are used then built in implementation of the session scope, the request scope and the conversation scope, will become dissociated, and you will find they are no longer active in the new thread, nor able to access their contextual data. The Weld <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/contexts.html">reference guide</a> contains information on how to associate a request to a context and activate it. Doing this in your new thread will cause the contexts to be active, and contain the same contextual data.</p>
                </div>
                <div class="paragraph">
                <p>The dependent context and the application context will work as usual in any user created thread.</p>
                </div>
                </div>
                </div>
              </div>
              <div id="1">
                <h3>
                  Why does Weld leave some proxy class definitions lying around when I undeploy my application? How can I prevent this?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>When a Weld-enabled application is deployed on an application server or a web server, proxy classes for beans implementing interfaces or extending classes contained in common libraries are loaded in the class loader (CL) for that library, not the thread context class loader (TCCL). This means that these proxy classes will not be removed from the server when the application is undeployed.</p>
                </div>
                <div class="paragraph">
                <p>The reason for this approach is to support the use of package scoped classes and members of classes which need to be proxied as beans. Thus the TCCL is not used for the proxy classes generated by Weld.</p>
                </div>
                <div class="paragraph">
                <p>One way to prevent this problem is to simply deploy those libraries with your application. In this scenario, those classes are loaded in a CL associated with the application and will thus be removed when the application is undeployed.</p>
                </div>
                </div>
                </div>
              </div>
              <div id="2">
                <h3>
                  Some of my beans aren&#8217;t deployed and I can&#8217;t see why?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>Weld will not create beans if it can&#8217;t load the class, or some class dependency. If that happens, you&#8217;ll see a note in the server log.</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>WELD-000119: Not generating any bean definitions from org.jboss.weld.tests.beanDeployment.noclassdeffound.Bar because of underlying class loading error</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>You can view more details by increasing the log level of the application server to DEBUG. (For how to do it, see <a href="#7">How do I change the log level for Weld in a specific container?</a>)</p>
                </div>
                </div>
                </div>
              </div>
              <div id="3">
                <h3>
                  Why does Weld set character encoding of an HTTP request/response body to ISO-8859-1?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>An application may set character encoding of a request by calling the <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletRequest.html#setCharacterEncoding(java.lang.String)">ServletRequest.setCharacterEncoding()</a> method. This method has a limitation: it has to be called before the request parameters or request body are read, otherwise the method call has no effect.</p>
                </div>
                <div class="paragraph">
                <p>In order to properly activate the conversation context, Weld reads the <em>cid</em> request parameter in the beginning of request processing (see <a href="http://docs.jboss.org/cdi/spec/1.1/cdi-spec.html#conversation_context">the CDI spec for details</a>). As a side-effect, this makes it impossible to change the character encoding later in the request processing (since request parameters have been read already). As a result, an application servlet or filter that tries to set character encoding will not work since it does that too late.</p>
                </div>
                <div class="paragraph">
                <p>A workaround is to have the application encoding-setting filter to be called before Weld tries to read the "cid" parameter in the ConversationFilter. This can be done by mapping the custom filter <em>before</em> Weld&#8217;s ConversationFilter in web.xml</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code class="xml language-xml">&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" version="3.0"&gt;&#x000A;    &lt;filter&gt;&#x000A;        &lt;filter-name&gt;SetCharacterEncoding&lt;/filter-name&gt;&#x000A;        &lt;filter-class&gt;org.apache.catalina.filters.SetCharacterEncodingFilter&lt;/filter-class&gt;&#x000A;        &lt;init-param&gt;&#x000A;            &lt;param-name&gt;encoding&lt;/param-name&gt;&#x000A;            &lt;param-value&gt;UTF-8&lt;/param-value&gt;&#x000A;        &lt;/init-param&gt;&#x000A;        &lt;init-param&gt;&#x000A;            &lt;param-name&gt;ignore&lt;/param-name&gt;&#x000A;            &lt;param-value&gt;false&lt;/param-value&gt;&#x000A;        &lt;/init-param&gt;&#x000A;    &lt;/filter&gt;&#x000A;    &lt;filter-mapping&gt;&#x000A;        &lt;filter-name&gt;SetCharacterEncoding&lt;/filter-name&gt;&#x000A;        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&#x000A;    &lt;/filter-mapping&gt;&#x000A;    &lt;filter-mapping&gt;&#x000A;        &lt;filter-name&gt;CDI Conversation Filter&lt;/filter-name&gt;&#x000A;        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&#x000A;    &lt;/filter-mapping&gt;&#x000A;&lt;/web-app&gt;</code></pre>
                </div>
                </div>
                </div>
                </div>
              </div>
              <div id="4">
                <h3>
                  My application bundles a third-party library which uses javax.inject annotations. This library was not intended to be a CDI library but on CDI 1.1 this library is being picked up as an implicit bean archive and breaks the deployment of my application. Why is this happening?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>Firstly, this issue only affects CDI 1.1. If possible, go and upgrade to CDI 1.2 (Weld 2.2 or later) where this issue does not occur.</p>
                </div>
                <div class="paragraph">
                <p>If you cannot do that, read further:
                This is a <a href="https://issues.jboss.org/browse/CDI-377">known issue</a> in the CDI 1.1 specification and occurs with third-party libraries such as <a href="https://code.google.com/p/guava-libraries/issues/detail?id=1433">Guava</a>.</p>
                </div>
                <div class="paragraph">
                <p>A workaround is to configure the application server to require the <code>beans.xml</code> file in bean archives (suppress implicit bean archives). The way to configure this varies across application servers:</p>
                </div>
                <div class="paragraph">
                <p><strong>GlassFish 4</strong></p>
                </div>
                <div class="paragraph">
                <p>global configuration:</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>asadmin set configs.config.server-config.cdi-service.enable-implicit-cdi=false</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>per-deployment configuration:</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>asadmin deploy --property implicitCdiEnabled=false &lt;archive&gt;</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p><strong>WildFly 8</strong></p>
                </div>
                <div class="paragraph">
                <p>global configuration:</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>/subsystem=weld:write-attribute(name=require-bean-descriptor,value=true)</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>per-deployment configuration - add the following content to <code>META-INF/jboss-all.xml</code> of the application</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>&lt;jboss xmlns="urn:jboss:1.0"&gt;&#x000A;    &lt;weld xmlns="urn:jboss:weld:1.0" require-bean-descriptor="true"/&gt;&#x000A;&lt;/jboss&gt;</code></pre>
                </div>
                </div>
                </div>
                </div>
              </div>
              <div id="5">
                <h3>
                  How can I bundle my entire SE application with Weld into a single jar?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>Weld internal classes are not intended to be used in a CDI deployment. As a result, you may <a href="https://issues.jboss.org/browse/WELD-1129">encounter validation errors</a> when packaging your application together with Weld in a single fat jar file.</p>
                </div>
                <div class="paragraph">
                <p>A workaround is to exclude Weld classes from bean scanning:</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code class="xml language-xml">&lt;beans xmlns="http://xmlns.jcp.org/xml/ns/javaee"&#x000A;       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;       xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"&#x000A;       version="1.1" bean-discovery-mode="all"&gt;&#x000A;    &lt;scan&gt;&#x000A;        &lt;exclude name="org.jboss.weld.**" /&gt;&#x000A;    &lt;/scan&gt;&#x000A;&lt;/beans&gt;</code></pre>
                </div>
                </div>
                </div>
                </div>
              </div>
              <div id="6">
                <h3>
                  I use the Instance API to obtain bean instances. Why does it seem to cause a memory leak?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                <div class="paragraph">
                <p>The <code>Instance</code> API is often used in loops to obtain multiple instances of a certain bean. Here is an example:</p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code class="java language-java">    @Inject&#x000A;    private Instance&lt;A&gt; instance;&#x000A;&#x000A;    public void foo() {&#x000A;        // obtain multiple instances of A&#x000A;        for (;;) {&#x000A;            instance.get();&#x000A;    }</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>By default, each object obtained using <code>Instance</code> remains managed (is not released) until the <code>Instance</code> object is destroyed. This can easily create a memory leak.
                Therefore, the application should explicitly destroy obtained instances when it no longer needs by calling the <a href="http://docs.jboss.org/cdi/api/1.1/javax/enterprise/inject/Instance.html#destroy(T)">Instance.destroy()</a> method.</p>
                </div>
                </div>
                </div>
              </div>
              <div id="7">
                <h3>
                  How do I change the log level for Weld in a specific container?
                </h3>
                <div id="preamble">
                <div class="sectionbody">
                
                <div class="paragraph">
                <p>When things do not work as expected, more information might be helpful in solving the problem. For this reason, you might want to enable the debug (fine) logging level for Weld.</p>
                </div>
                <div>
                <p>Each container has its own way to do this:</p>
                </div>
                <div class="paragraph">
                <p><strong>GlassFish</strong> (more info: <a href="http://docs.oracle.com/cd/E19798-01/821-1751/ghgwi/index.html">Setting Log Levels - GlassFish</a>)</p>
                </div>
                <div class="paragraph">
                <p>global configuration - add the following line to <code><i>domain-dir</i>/config/logging.properties</code></p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>org.jboss.weld.level=FINE</code></pre>
                </div>
                </div>

                <div class="paragraph">
                <p><strong>WildFly</strong> (more info: <a href="https://docs.jboss.org/author/display/WFLY8/Logging+Configuration">Logging Configuration - WildFly</a>)</p>
                </div>
                <div class="paragraph">
                <p>global configuration - add the following content to the logging subsystem (<code class="xml language-xml">&lt;subsystem xmlns="urn:jboss:domain:logging:..."&gt;</code>) in <code>$JBOSS_HOME/standalone/configuration/standalone-full.xml</code></p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code class="xml language-xml">&lt;logger category="org.jboss.weld"&gt;&#x000A;       &lt;level name="DEBUG"/&gt;&#x000A;&lt;/logger&gt;</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>per-deployment configuration - add the following line to the logging configuration file (e.g. <code>META-INF/logging.properties</code>) of the application</p>
                <!-- use-deployment-logging-config in standalone-full.xml must not be set to false  -->
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>org.jboss.weld.level=DEBUG</code></pre>
                </div>
                </div>
                
                <div class="paragraph">
                <p><strong>Tomcat</strong> (more info: <a href="http://tomcat.apache.org/tomcat-7.0-doc/logging.html">Logging in Tomcat</a>)</p>
                </div>
                <div class="paragraph">
                <p>global configuration - add the following line to <code>$CATALINA_HOME/conf/logging.properties</code></p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>org.jboss.weld.level=FINE</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>per-deployment configuration - add the following line to <code>WEB-INF/classes/logging.properties</code></p>
                </div>
                <div class="listingblock">
                <div class="content">
                <pre class="highlight"><code>org.jboss.weld.level=FINE</code></pre>
                </div>
                </div>
                
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer>
        <div class="row">
          <p>
            Copyright &copy; 2014,
            <a href="http://redhat.com">
              Red Hat, Inc.
            </a>
            Weld is licensed under the
            <a href="http://www.apache.org/licenses/LICENSE-2.0.html">
              Apache License, Version 2.0
            </a>
          </p>
        </div>
      </footer>
    </div>
  </body>
  <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount','UA-45187401-1']);
  _gaq.push(['_trackPageview']);
  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>
  <script>
    $(document).ready(function() {
      $('#toggle_menu').click(function(){
        $("#mobile_menu").toggle();
      });
    });
  </script>
</html>
